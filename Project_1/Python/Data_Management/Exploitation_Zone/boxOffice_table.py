import os
from pathlib import Path
from delta import *
import sys
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))
from utils import *


def boxOffice_table(spark, boxoffice_delta_path='../../../Data Management/Trusted Zone/boxoffice/', 
                    exploitation_zone_base='../../../Data Management/Exploitation Zone/'):

    # spark = get_spark_session()
    exploitation_zone_base = Path(exploitation_zone_base)
    exploitation_zone_base.mkdir(parents=True, exist_ok=True)

    boxoffice_tables = load_delta_tables(boxoffice_delta_path, spark)

    boxoffice_df = boxoffice_tables['boxoffice_movie_data'].select('Awards', 'Director', 'Distributor', 'Genre', 'Poster',
                                                                   'Language', 'Released', 'Title', 'imdbRating', 'imdbVotes')
    boxoffice_exploitation_path = Path(exploitation_zone_base) / 'boxoffice'
    boxoffice_exploitation_path.mkdir(parents=True, exist_ok=True)
    boxoffice_df.write.format('delta').mode('overwrite').save(str(boxoffice_exploitation_path / 'boxoffice_movie_data'))


    # spark.stop()


# boxOffice_table()



